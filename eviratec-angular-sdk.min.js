/**
 * eviratec-angular-sdk@v1.0.0-alpha.1
 * Built on 2017-04-10T06:10:22Z
 *
 * Copyright (c) 2017 Callan Peter Milne
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above 
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 * PERFORMANCE OF THIS SOFTWARE.
 */

!function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function c(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(d){var e=function(d){function e(c){return a(this,e),b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c))}return c(e,d),e}(d);return e}function e(d){var e=function(d){function e(c){return a(this,e),b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c))}return c(e,d),e}(d);return e}function f(){var b=Object.prototype.hasOwnProperty,c="function"!=typeof Object.create&&"~",d=function b(c,d,e){a(this,b),this.fn=c,this.context=d,this.once=e||!1},e=function(){function e(){a(this,e),this._events=void 0}return l(e,null,[{key:"prefixed",get:function(){return c}}]),l(e,[{key:"eventNames",value:function(){var a,d=this._events,e=[];if(!d)return e;for(a in d)b.call(d,a)&&e.push(c?a.slice(1):a);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(d)):e}},{key:"listeners",value:function(a,b){var d=c?c+a:a,e=this._events&&this._events[d];if(b)return!!e;if(!e)return[];if(e.fn)return[e.fn];for(var f=0,g=e.length,h=new Array(g);f<g;f++)h[f]=e[f].fn;return h}},{key:"emit",value:function(a,b,d,e,f,g){var h=c?c+a:a;if(!this._events||!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if("function"==typeof k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,d),!0;case 4:return k.fn.call(k.context,b,d,e),!0;case 5:return k.fn.call(k.context,b,d,e,f),!0;case 6:return k.fn.call(k.context,b,d,e,f,g),!0}for(j=1,i=new Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,d);break;default:if(!i)for(m=1,i=new Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0}},{key:"on",value:function(a,b,e){var f=new d(b,e||this),g=c?c+a:a;return this._events||(this._events=c?{}:Object.create(null)),this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],f]:this._events[g].push(f):this._events[g]=f,this}},{key:"once",value:function(a,b,e){var f=new d(b,e||this,!0),g=c?c+a:a;return this._events||(this._events=c?{}:Object.create(null)),this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],f]:this._events[g].push(f):this._events[g]=f,this}},{key:"removeListener",value:function(a,b,d,e){var f=c?c+a:a;if(!this._events||!this._events[f])return this;var g=this._events[f],h=[];if(b)if(g.fn)(g.fn!==b||e&&!g.once||d&&g.context!==d)&&h.push(g);else for(var i=0,j=g.length;i<j;i++)(g[i].fn!==b||e&&!g[i].once||d&&g[i].context!==d)&&h.push(g[i]);return h.length?this._events[f]=1===h.length?h[0]:h:delete this._events[f],this}},{key:"removeAllListeners",value:function(a){return this._events?(a?delete this._events[c?c+a:a]:this._events=c?{}:Object.create(null),this):this}},{key:"off",value:function(){this.removeListener.apply(this,arguments)}},{key:"addListener",value:function(){this.on.apply(this,arguments)}},{key:"setMaxListeners",value:function(){return this}}]),e}();return e}function g(d,e){function f(a){return e({method:"GET",url:a.uri,headers:{"Content-Type":"application/json"}})}var g=function(d){function e(c){a(this,e);var d=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return d.isDownloaded=!1,d.uri=c||"https://localhost/resource",d.data={},d.once("downloaded",function(){d.isDownloaded=!0}),d}return c(e,d),l(e,[{key:"download",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(c,d){var e=!0===a.isDownloaded;return!1===b&&e?c(a):void a.fetch().then(function(){a.emit("downloaded",a.data,res),c(a)}).catch(function(b){a.emit("download_error",b),d(b)})})}},{key:"fetch",value:function(a,b){var c=this;return new Promise(function(a,b){f(c).then(function(b){Object.assign(c.data,b.data||{}),a(c)},function(a){b(a)})})}}]),e}(d);return g}function h(b,c){function d(){return e()?g():f()}function e(){return!!b.get(j)}function f(){return c.v4String()+"."+c.v4String().substr(0,7)}function g(){return b.get(j)}function h(){return b.remove(j)}function i(a,c){var d=c;b.put(j,d),a.id=d}var j="EV_SESSION",k=function(){function b(c){a(this,b),i(this,c)}return l(b,[{key:"SESSION_COOKIE",get:function(){return j}}]),l(b,[{key:"reset",value:function(){h(),i(this,f())}}]),b}();return new k(d())}function i(b,c){function d(a,c){return new Promise(function(d,e){b.get(a+"/sso/id?a="+c).then(function(a){d(a.data)},function(){e()})})}function e(a,c){return new Promise(function(d,e){b.post(a+"/sso/logout?a="+c).then(function(a){d(a.data)},function(){e()})})}function f(a){return a.d.loginUrl}var g="eviratecDialog",h=["width=800","height=500","resizable=yes","scrollbars=yes","status=yes"],i=function(){function b(d){if(a(this,b),!d)throw new Error("Hostname expected as first argument");this.remoteHost=d,this.d={anonymous:!0},this.session=c}return l(b,[{key:"init",value:function(){var a=this;d(this.remoteHost,this.session.id).then(function(b){Object.assign(a.d,b)})}},{key:"refresh",value:function(){var a=this;return new Promise(function(b,c){d(a.remoteHost,a.session.id).then(function(c){Object.assign(a.d,c),b()})})}},{key:"login",value:function(){if(this.isLoggedIn)return!1;var a=f(this),b=h.join(",");return window.open(a,g,b)}},{key:"logout",value:function(){try{e(this.remoteHost,this.session.id)}catch(a){}return this.session.reset(),this.refresh()}},{key:"isLoggedIn",get:function(){return!1===this.d.anonymous}},{key:"userFullName",get:function(){if(!this.isLoggedIn)return"";var a=void 0;return a=this.d.login.owner,a.given_name+" "+a.family_name}}]),b}();return i}function j(a){function b(){return d.ssoHost}function c(a){return d.ssoHost=a}var d={ssoHost:a};this.ssoHost=function(a){return void 0===a?b():(c(a),this)},this.$get=["Sso",function(a){return new a(b())}]}function k(a){function b(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=n[a])});e<16;)b[d+e++]=0;return b}function c(a,b){var c=b||0,d=m;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function d(a,b,d){var e=b&&d||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:r,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:t+1,j=h-s+(i-t)/1e4;if(j<0&&null==a.clockseq&&(g=g+1&16383),(j<0||h>s)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=h,t=i,r=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||q,n=0;n<6;n++)f[e+n]=m[n];return b?b:c(f)}function e(a,b,d){var e=b&&d||0;"string"==typeof a&&(b="binary"===a?new l(16):null,a=null),a=a||{};var g=a.random||(a.rng||f)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;h<16;h++)b[e+h]=g[h];return b||c(g)}var f,g,h,i=a.crypto||a.msCrypto;if(!f&&i&&i.getRandomValues)try{var j=new Uint8Array(16);h=f=function(){return i.getRandomValues(j),j},f()}catch(a){}if(!f){var k=new Array(16);g=f=function(){for(var a,b=0;b<16;b++)0===(3&b)&&(a=4294967296*Math.random()),k[b]=a>>>((3&b)<<3)&255;return k},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}for(var l="function"==typeof Buffer?Buffer:Array,m=[],n={},o=0;o<256;o++)m[o]=(o+256).toString(16).substr(1),n[m[o]]=o;var p=f(),q=[1|p[0],p[1],p[2],p[3],p[4],p[5]],r=16383&(p[6]<<8|p[7]),s=0,t=0,u=e;return u.v1=d,u.v4=e,u.parse=b,u.unparse=c,u.BufferClass=l,u._rng=f,u._mathRNG=g,u._whatwgRNG=h,u}function k(b){var c=function(){function c(){a(this,c)}return l(c,[{key:"SESSION_COOKIE",get:function(){return SESSION_COOKIE}}],[{key:"v4String",value:function(){return b.v4()}}]),c}();return c}var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m="eviratecNgSdk",n=["ngCookies"],o=angular.module(m,n);o.constant("D_SSO_HOST","https://login.eviratec.co"),o.factory("CachedEntity",d),d.$inject=["RemoteResource"],o.factory("CachedQuery",e),e.$inject=["RemoteResource"],o.factory("EventEmitter",f),f.$inject=[],o.factory("RemoteResource",g),g.$inject=["EventEmitter","$http"],o.factory("$session",h),h.$inject=["$cookies","Uuid"],o.factory("SingleSignOn",i),i.$inject=["$http","$session"],o.provider("$sso",j),j.$inject=["D_SSO_HOST"],o.factory("uuid",k),k.$inject=["$window"],o.factory("Uuid",k),k.$inject=["uuid"]}();
